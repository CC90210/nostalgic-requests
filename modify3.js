const fs = require('fs'); const file = 'app/api/stripe/checkout/route.ts'; let c = fs.readFileSync(file, 'utf8'); c = c.split('import { z } from \"zod\";').join('import { z } from \"zod\";\nimport { rateLimit } from \"@/lib/rate-limit\";\nimport { isPlatformOwner } from \"@/lib/platform\";'); c = c.split('const body = await request.json();').join('const ip = request.headers.get(\"x-forwarded-for\") || \"unknown\";\n    const { allowed } = rateLimit(\"checkout_\" + ip, 5, 60000);\n    if (!allowed) {\n      return NextResponse.json({ error: \"Too many requests. Please wait a moment.\" }, { status: 429 });\n    }\n\n    const body = await request.json();'); c = c.split('if (djEmail.toLowerCase().trim() === \"konamak@icloud.com\") {').join('if (isPlatformOwner(djEmail)) {'); let pToken = 'if (profile?.stripe_account_id && profile?.stripe_onboarding_complete) {\r\n          destinationAccount = profile.stripe_account_id;\r\n        }'; let newPToken = 'if (profile?.stripe_account_id && profile?.stripe_onboarding_complete) {\n          destinationAccount = profile.stripe_account_id;\n        } else {\n          return NextResponse.json(\n            { error: \"This DJ hasn\\'t set up payments yet. Please ask them to complete setup.\" },\n            { status: 400 }\n          );\n        }'; c = c.split(pToken).join(newPToken); pToken = pToken.replace(/\r\n/g, '\n'); c = c.split(pToken).join(newPToken); fs.writeFileSync(file, c); console.log(\"done3\");
